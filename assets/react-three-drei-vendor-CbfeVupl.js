function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/troika-three-text.esm-DrKafjtB.js","assets/three-vendor-BlRjbAe-.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{a as _i,r as c}from"./react-vendor-D8fagYP-.js";import{V as I,D as yi,O as Ve,P as Xs,c as ut,j as ee,C as Be,Q as zt,k as Ye,l as Gt,E as vi,m as Ws,F as Ze,n as gi,o as Ei,p as fe,q as Ne,r as ye,B as Oi,s as $s,t as yt,u as Ti,v as xi,w as ht,x as De,H as wi,y as Ci,z as he,a as Mi,G as Ui,I as Ae,J as Si,K as Pi,X as Ri,S as Di,Y as Ai,Z as bi,_ as ve,$}from"./three-vendor-BlRjbAe-.js";import{u as Y,a as Mt,c as Qs,s as be,p as Li,b as Fi,e as je,d as qe,f as zi,g as Ii,h as ki}from"./react-three-fiber-vendor-YLb0z6Im.js";import{F as Hi,T as Vi,m as Bi,S as Yi,G as Ke,D as Zi,M as ge,H as Ni,V as ji,a as bt}from"./three-stdlib-vendor-CSeERQbj.js";var Je={},Gs,ts=_i;Gs=Je.createRoot=ts.createRoot,Je.hydrateRoot=ts.hydrateRoot;const qi="modulepreload",Ki=function(e){return"/portal/"+e},es={},Xi=function(t,s,i){let r=Promise.resolve();if(s&&s.length>0){const o=document.getElementsByTagName("link"),n=document.querySelector("meta[property=csp-nonce]"),a=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));r=Promise.all(s.map(l=>{if(l=Ki(l),l in es)return;es[l]=!0;const m=l.endsWith(".css"),g=m?'[rel="stylesheet"]':"";if(!!i)for(let _=o.length-1;_>=0;_--){const T=o[_];if(T.href===l&&(!m||T.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${g}`))return;const f=document.createElement("link");if(f.rel=m?"stylesheet":qi,m||(f.as="script",f.crossOrigin=""),f.href=l,a&&f.setAttribute("nonce",a),document.head.appendChild(f),m)return new Promise((_,T)=>{f.addEventListener("load",_),f.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${l}`)))})}))}return r.then(()=>t()).catch(o=>{const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=o,window.dispatchEvent(n),!n.defaultPrevented)throw o})};function j(){return j=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},j.apply(this,arguments)}const Jt=new I,Xe=new I,Wi=new I,ss=new ut;function $i(e,t,s){const i=Jt.setFromMatrixPosition(e.matrixWorld);i.project(t);const r=s.width/2,o=s.height/2;return[i.x*r+r,-(i.y*o)+o]}function Qi(e,t){const s=Jt.setFromMatrixPosition(e.matrixWorld),i=Xe.setFromMatrixPosition(t.matrixWorld),r=s.sub(i),o=t.getWorldDirection(Wi);return r.angleTo(o)>Math.PI/2}function Gi(e,t,s,i){const r=Jt.setFromMatrixPosition(e.matrixWorld),o=r.clone();o.project(t),ss.set(o.x,o.y),s.setFromCamera(ss,t);const n=s.intersectObjects(i,!0);if(n.length){const a=n[0].distance;return r.distanceTo(s.ray.origin)<a}return!0}function Ji(e,t){if(t instanceof Ve)return t.zoom;if(t instanceof Xs){const s=Jt.setFromMatrixPosition(e.matrixWorld),i=Xe.setFromMatrixPosition(t.matrixWorld),r=t.fov*Math.PI/180,o=s.distanceTo(i);return 1/(2*Math.tan(r/2)*o)}else return 1}function tr(e,t,s){if(t instanceof Xs||t instanceof Ve){const i=Jt.setFromMatrixPosition(e.matrixWorld),r=Xe.setFromMatrixPosition(t.matrixWorld),o=i.distanceTo(r),n=(s[1]-s[0])/(t.far-t.near),a=s[1]-n*t.far;return Math.round(n*o+a)}}const Le=e=>Math.abs(e)<1e-10?0:e;function Js(e,t,s=""){let i="matrix3d(";for(let r=0;r!==16;r++)i+=Le(t[r]*e.elements[r])+(r!==15?",":")");return s+i}const er=(e=>t=>Js(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),sr=(e=>(t,s)=>Js(t,e(s),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function ir(e){return e&&typeof e=="object"&&"current"in e}const Mn=c.forwardRef(({children:e,eps:t=.001,style:s,className:i,prepend:r,center:o,fullscreen:n,portal:a,distanceFactor:l,sprite:m=!1,transform:g=!1,occlude:u,onOcclude:f,castShadow:_,receiveShadow:T,material:v,geometry:O,zIndexRange:h=[16777271,0],calculatePosition:y=$i,as:w="div",wrapperClass:p,pointerEvents:x="auto",...E},C)=>{const{gl:U,camera:P,scene:L,size:A,raycaster:W,events:G,viewport:q}=Y(),[k]=c.useState(()=>document.createElement(w)),vt=c.useRef(),N=c.useRef(null),dt=c.useRef(0),mt=c.useRef([0,0]),K=c.useRef(null),X=c.useRef(null),ft=(a==null?void 0:a.current)||G.connected||U.domElement.parentNode,it=c.useRef(null),It=c.useRef(!1),J=c.useMemo(()=>u&&u!=="blending"||Array.isArray(u)&&u.length&&ir(u[0]),[u]);c.useLayoutEffect(()=>{const V=U.domElement;u&&u==="blending"?(V.style.zIndex=`${Math.floor(h[0]/2)}`,V.style.position="absolute",V.style.pointerEvents="none"):(V.style.zIndex=null,V.style.position=null,V.style.pointerEvents=null)},[u]),c.useLayoutEffect(()=>{if(N.current){const V=vt.current=Gs(k);if(L.updateMatrixWorld(),g)k.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const R=y(N.current,P,A);k.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${R[0]}px,${R[1]}px,0);transform-origin:0 0;`}return ft&&(r?ft.prepend(k):ft.appendChild(k)),()=>{ft&&ft.removeChild(k),V.unmount()}}},[ft,g]),c.useLayoutEffect(()=>{p&&(k.className=p)},[p]);const tt=c.useMemo(()=>g?{position:"absolute",top:0,left:0,width:A.width,height:A.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:o?"translate3d(-50%,-50%,0)":"none",...n&&{top:-A.height/2,left:-A.width/2,width:A.width,height:A.height},...s},[s,o,n,A,g]),ot=c.useMemo(()=>({position:"absolute",pointerEvents:x}),[x]);c.useLayoutEffect(()=>{if(It.current=!1,g){var V;(V=vt.current)==null||V.render(c.createElement("div",{ref:K,style:tt},c.createElement("div",{ref:X,style:ot},c.createElement("div",{ref:C,className:i,style:s,children:e}))))}else{var R;(R=vt.current)==null||R.render(c.createElement("div",{ref:C,style:tt,className:i,children:e}))}});const F=c.useRef(!0);Mt(V=>{if(N.current){P.updateMatrixWorld(),N.current.updateWorldMatrix(!0,!1);const R=g?mt.current:y(N.current,P,A);if(g||Math.abs(dt.current-P.zoom)>t||Math.abs(mt.current[0]-R[0])>t||Math.abs(mt.current[1]-R[1])>t){const Et=Qi(N.current,P);let pt=!1;J&&(Array.isArray(u)?pt=u.map(Ot=>Ot.current):u!=="blending"&&(pt=[L]));const kt=F.current;if(pt){const Ot=Gi(N.current,P,W,pt);F.current=Ot&&!Et}else F.current=!Et;kt!==F.current&&(f?f(!F.current):k.style.display=F.current?"block":"none");const te=Math.floor(h[0]/2),ci=u?J?[h[0],te]:[te-1,0]:h;if(k.style.zIndex=`${tr(N.current,P,ci)}`,g){const[Ot,Qe]=[A.width/2,A.height/2],_e=P.projectionMatrix.elements[5]*Qe,{isOrthographicCamera:Ge,top:hi,left:ui,bottom:di,right:mi}=P,fi=er(P.matrixWorldInverse),pi=Ge?`scale(${_e})translate(${Le(-(mi+ui)/2)}px,${Le((hi+di)/2)}px)`:`translateZ(${_e}px)`;let Tt=N.current.matrixWorld;m&&(Tt=P.matrixWorldInverse.clone().transpose().copyPosition(Tt).scale(N.current.scale),Tt.elements[3]=Tt.elements[7]=Tt.elements[11]=0,Tt.elements[15]=1),k.style.width=A.width+"px",k.style.height=A.height+"px",k.style.perspective=Ge?"":`${_e}px`,K.current&&X.current&&(K.current.style.transform=`${pi}${fi}translate(${Ot}px,${Qe}px)`,X.current.style.transform=sr(Tt,1/((l||10)/400)))}else{const Ot=l===void 0?1:Ji(N.current,P)*l;k.style.transform=`translate3d(${R[0]}px,${R[1]}px,0) scale(${Ot})`}mt.current=R,dt.current=P.zoom}}if(!J&&it.current&&!It.current)if(g){if(K.current){const R=K.current.children[0];if(R!=null&&R.clientWidth&&R!=null&&R.clientHeight){const{isOrthographicCamera:Et}=P;if(Et||O)E.scale&&(Array.isArray(E.scale)?E.scale instanceof I?it.current.scale.copy(E.scale.clone().divideScalar(1)):it.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):it.current.scale.setScalar(1/E.scale));else{const pt=(l||10)/400,kt=R.clientWidth*pt,te=R.clientHeight*pt;it.current.scale.set(kt,te,1)}It.current=!0}}}else{const R=k.children[0];if(R!=null&&R.clientWidth&&R!=null&&R.clientHeight){const Et=1/q.factor,pt=R.clientWidth*Et,kt=R.clientHeight*Et;it.current.scale.set(pt,kt,1),It.current=!0}it.current.lookAt(V.camera.position)}});const at=c.useMemo(()=>({vertexShader:g?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[g]);return c.createElement("group",j({},E,{ref:N}),u&&!J&&c.createElement("mesh",{castShadow:_,receiveShadow:T,ref:it},O||c.createElement("planeGeometry",null),v||c.createElement("shaderMaterial",{side:yi,vertexShader:at.vertexShader,fragmentShader:at.fragmentShader})))});function Un(e,t="pointer",s="auto",i=document.body){c.useEffect(()=>{if(e)return i.style.cursor=t,()=>void(i.style.cursor=s)},[e])}let Ht=0;const rr=Qs(e=>(ee.onStart=(t,s,i)=>{e({active:!0,item:t,loaded:s,total:i,progress:(s-Ht)/(i-Ht)*100})},ee.onLoad=()=>{e({active:!1})},ee.onError=t=>e(s=>({errors:[...s.errors,t]})),ee.onProgress=(t,s,i)=>{s===i&&(Ht=i),e({active:!0,item:t,loaded:s,total:i,progress:(s-Ht)/(i-Ht)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),nr=e=>`Loading ${e.toFixed(2)}%`;function Sn({containerStyles:e,innerStyles:t,barStyles:s,dataStyles:i,dataInterpolation:r=nr,initialState:o=n=>n}){const{active:n,progress:a}=rr(),l=c.useRef(0),m=c.useRef(0),g=c.useRef(null),[u,f]=c.useState(o(n));c.useEffect(()=>{let T;return n!==u&&(T=setTimeout(()=>f(n),300)),()=>clearTimeout(T)},[u,n]);const _=c.useCallback(()=>{g.current&&(l.current+=(a-l.current)/2,(l.current>.95*a||a===100)&&(l.current=a),g.current.innerText=r(l.current),l.current<a&&(m.current=requestAnimationFrame(_)))},[r,a]);return c.useEffect(()=>(_(),()=>cancelAnimationFrame(m.current)),[_]),u?c.createElement("div",{style:{...se.container,opacity:n?1:0,...e}},c.createElement("div",null,c.createElement("div",{style:{...se.inner,...t}},c.createElement("div",{style:{...se.bar,transform:`scaleX(${a/100})`,...s}}),c.createElement("span",{ref:g,style:{...se.data,...i}})))):null}const se={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};function Qt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Fe(e,t){return Fe=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},Fe(e,t)}function or(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ze(e,t){(t==null||t>e.length)&&(t=e.length);for(var s=0,i=new Array(t);s<t;s++)i[s]=e[s];return i}function ar(e,t){if(e){if(typeof e=="string")return ze(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return ze(e,t)}}function lr(e){if(Array.isArray(e))return ze(e)}function cr(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function hr(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ur(e){return lr(e)||cr(e)||ar(e)||hr()}new ut;new ut;function dr(e,t,s){return Math.max(t,Math.min(s,e))}function mr(e,t){return dr(e-Math.floor(e/t)*t,0,t)}function fr(e,t){var s=mr(t-e,Math.PI*2);return s>Math.PI&&(s-=Math.PI*2),s}function We(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var et=function e(t,s,i){var r=this;We(this,e),Qt(this,"dot2",function(o,n){return r.x*o+r.y*n}),Qt(this,"dot3",function(o,n,a){return r.x*o+r.y*n+r.z*a}),this.x=t,this.y=s,this.z=i},pr=[new et(1,1,0),new et(-1,1,0),new et(1,-1,0),new et(-1,-1,0),new et(1,0,1),new et(-1,0,1),new et(1,0,-1),new et(-1,0,-1),new et(0,1,1),new et(0,-1,1),new et(0,1,-1),new et(0,-1,-1)],is=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],rs=new Array(512),ns=new Array(512),_r=function(t){t>0&&t<1&&(t*=65536),t=Math.floor(t),t<256&&(t|=t<<8);for(var s=0;s<256;s++){var i;s&1?i=is[s]^t&255:i=is[s]^t>>8&255,rs[s]=rs[s+256]=i,ns[s]=ns[s+256]=pr[i%12]}};_r(0);function yr(e){if(typeof e=="number")e=Math.abs(e);else if(typeof e=="string"){var t=e;e=0;for(var s=0;s<t.length;s++)e=(e+(s+1)*(t.charCodeAt(s)%96))%2147483647}return e===0&&(e=311),e}function os(e){var t=yr(e);return function(){var s=t*48271%2147483647;return t=s,s/2147483647}}var vr=function e(t){var s=this;We(this,e),Qt(this,"seed",0),Qt(this,"init",function(i){s.seed=i,s.value=os(i)}),Qt(this,"value",os(this.seed)),this.init(t)};new vr(Math.random());var gr=function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return i/Math.atan(1/s)*Math.atan(Math.sin(2*Math.PI*t*r)/s)},ti=function(t){return 1/(1+t+.48*t*t+.235*t*t*t)},Er=function(t){return t},Or={in:function(t){return 1-Math.cos(t*Math.PI/2)},out:function(t){return Math.sin(t*Math.PI/2)},inOut:function(t){return-(Math.cos(Math.PI*t)-1)/2}},Tr={in:function(t){return t*t*t},out:function(t){return 1-Math.pow(1-t,3)},inOut:function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}},xr={in:function(t){return t*t*t*t*t},out:function(t){return 1-Math.pow(1-t,5)},inOut:function(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2}},wr={in:function(t){return 1-Math.sqrt(1-Math.pow(t,2))},out:function(t){return Math.sqrt(1-Math.pow(t-1,2))},inOut:function(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2}},Cr={in:function(t){return t*t*t*t},out:function(t){return 1- --t*t*t*t},inOut:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t}},Mr={in:function(t){return t===0?0:Math.pow(2,10*t-10)},out:function(t){return t===1?1:1-Math.pow(2,-10*t)},inOut:function(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}};function B(e,t,s){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,n=arguments.length>6&&arguments[6]!==void 0?arguments[6]:ti,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,l="velocity_"+t;if(e.__damp===void 0&&(e.__damp={}),e.__damp[l]===void 0&&(e.__damp[l]=0),Math.abs(e[t]-s)<=a)return e[t]=s,!1;i=Math.max(1e-4,i);var m=2/i,g=n(m*r),u=e[t]-s,f=s,_=o*i;u=Math.min(Math.max(u,-_),_),s=e[t]-u;var T=(e.__damp[l]+m*u)*r;e.__damp[l]=(e.__damp[l]-m*T)*g;var v=s+(u+T)*g;return f-e[t]>0==v>f&&(v=f,e.__damp[l]=(v-f)/r),e[t]=v,!0}var Ur=function(t){return t&&t.isCamera},Sr=function(t){return t&&t.isLight},Vt=new I,as=new zt,ls=new zt,Bt=new Ye,Ee=new I;function Pr(e,t,s,i,r,o,n){typeof t=="number"?Vt.setScalar(t):Array.isArray(t)?Vt.set(t[0],t[1],t[2]):Vt.copy(t);var a=e.parent;e.updateWorldMatrix(!0,!1),Ee.setFromMatrixPosition(e.matrixWorld),Ur(e)||Sr(e)?Bt.lookAt(Ee,Vt,e.up):Bt.lookAt(Vt,Ee,e.up),ue(e.quaternion,ls.setFromRotationMatrix(Bt),s,i,r,o,n),a&&(Bt.extractRotation(a.matrixWorld),as.setFromRotationMatrix(Bt),ue(e.quaternion,ls.copy(e.quaternion).premultiply(as.invert()),s,i,r,o,n))}function Lt(e,t,s,i,r,o,n,a){return B(e,t,e[t]+fr(e[t],s),i,r,o,n,a)}var Yt=new ut,cs,hs;function Rr(e,t,s,i,r,o,n){return typeof t=="number"?Yt.setScalar(t):Array.isArray(t)?Yt.set(t[0],t[1]):Yt.copy(t),cs=B(e,"x",Yt.x,s,i,r,o,n),hs=B(e,"y",Yt.y,s,i,r,o,n),cs||hs}var Ut=new I,us,ds,ms;function Ie(e,t,s,i,r,o,n){return typeof t=="number"?Ut.setScalar(t):Array.isArray(t)?Ut.set(t[0],t[1],t[2]):Ut.copy(t),us=B(e,"x",Ut.x,s,i,r,o,n),ds=B(e,"y",Ut.y,s,i,r,o,n),ms=B(e,"z",Ut.z,s,i,r,o,n),us||ds||ms}var xt=new Gt,fs,ps,_s,ys;function Dr(e,t,s,i,r,o,n){return typeof t=="number"?xt.setScalar(t):Array.isArray(t)?xt.set(t[0],t[1],t[2],t[3]):xt.copy(t),fs=B(e,"x",xt.x,s,i,r,o,n),ps=B(e,"y",xt.y,s,i,r,o,n),_s=B(e,"z",xt.z,s,i,r,o,n),ys=B(e,"w",xt.w,s,i,r,o,n),fs||ps||_s||ys}var Zt=new vi,vs,gs,Es;function Ar(e,t,s,i,r,o,n){return Array.isArray(t)?Zt.set(t[0],t[1],t[2],t[3]):Zt.copy(t),vs=Lt(e,"x",Zt.x,s,i,r,o,n),gs=Lt(e,"y",Zt.y,s,i,r,o,n),Es=Lt(e,"z",Zt.z,s,i,r,o,n),vs||gs||Es}var St=new Be,Os,Ts,xs;function br(e,t,s,i,r,o,n){return t instanceof Be?St.copy(t):Array.isArray(t)?St.setRGB(t[0],t[1],t[2]):St.set(t),Os=B(e,"r",St.r,s,i,r,o,n),Ts=B(e,"g",St.g,s,i,r,o,n),xs=B(e,"b",St.b,s,i,r,o,n),Os||Ts||xs}var rt=new zt,_t=new Gt,ws=new Gt,Nt=new Gt,Cs,Ms,Us,Ss;function ue(e,t,s,i,r,o,n){var a=e;Array.isArray(t)?rt.set(t[0],t[1],t[2],t[3]):rt.copy(t);var l=e.dot(rt)>0?1:-1;return rt.x*=l,rt.y*=l,rt.z*=l,rt.w*=l,Cs=B(e,"x",rt.x,s,i,r,o,n),Ms=B(e,"y",rt.y,s,i,r,o,n),Us=B(e,"z",rt.z,s,i,r,o,n),Ss=B(e,"w",rt.w,s,i,r,o,n),_t.set(e.x,e.y,e.z,e.w).normalize(),ws.set(a.__damp.velocity_x,a.__damp.velocity_y,a.__damp.velocity_z,a.__damp.velocity_w),Nt.copy(_t).multiplyScalar(ws.dot(_t)/_t.dot(_t)),a.__damp.velocity_x-=Nt.x,a.__damp.velocity_y-=Nt.y,a.__damp.velocity_z-=Nt.z,a.__damp.velocity_w-=Nt.w,e.set(_t.x,_t.y,_t.z,_t.w),Cs||Ms||Us||Ss}var jt=new Ws,Ps,Rs,Ds;function Lr(e,t,s,i,r,o,n){return Array.isArray(t)?jt.set(t[0],t[1],t[2]):jt.copy(t),Ps=B(e,"radius",jt.radius,s,i,r,o,n),Rs=Lt(e,"phi",jt.phi,s,i,r,o,n),Ds=Lt(e,"theta",jt.theta,s,i,r,o,n),Ps||Rs||Ds}var ie=new Ye,As=new I,bs=new zt,Ls=new I,Fs,zs,Is;function Fr(e,t,s,i,r,o,n){var a=e;return a.__damp===void 0&&(a.__damp={position:new I,rotation:new zt,scale:new I},e.decompose(a.__damp.position,a.__damp.rotation,a.__damp.scale)),Array.isArray(t)?ie.set.apply(ie,ur(t)):ie.copy(t),ie.decompose(As,bs,Ls),Fs=Ie(a.__damp.position,As,s,i,r,o,n),zs=ue(a.__damp.rotation,bs,s,i,r,o,n),Is=Ie(a.__damp.scale,Ls,s,i,r,o,n),e.compose(a.__damp.position,a.__damp.rotation,a.__damp.scale),Fs||zs||Is}var Pn=Object.freeze({__proto__:null,rsqw:gr,exp:ti,linear:Er,sine:Or,cubic:Tr,quint:xr,circ:wr,quart:Cr,expo:Mr,damp:B,dampLookAt:Pr,dampAngle:Lt,damp2:Rr,damp3:Ie,damp4:Dr,dampE:Ar,dampC:br,dampQ:ue,dampS:Lr,dampM:Fr});function zr(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}function de(e){return de=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)},de(e)}function Ir(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kr(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ir(e)}function Hr(e){var t=or();return function(){var i=de(e),r;if(t){var o=de(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return kr(this,r)}}var Vr=function(e){zr(s,e);var t=Hr(s);function s(){var i,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:.2,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:16;We(this,s),i=t.call(this),i.parameters={width:r,height:o,radius:n,segments:a};for(var l=r/2-n,m=o/2-n,g=n/r,u=(r-n)/r,f=n/o,_=(o-n)/o,T=[l,m,0,-l,m,0,-l,-m,0,l,-m,0],v=[u,_,g,_,g,f,u,f],O=[3*(a+1)+3,3*(a+1)+4,a+4,a+5,2*(a+1)+4,2,1,2*(a+1)+3,3,4*(a+1)+3,4,0],h=[O[0],O[1],O[2],O[0],O[2],O[3],O[4],O[5],O[6],O[4],O[6],O[7],O[8],O[9],O[10],O[8],O[10],O[11]],y,w,p,x,E,C,U,P,L=0;L<4;L++){x=L<1||L>2?l:-l,E=L<2?m:-m,C=L<1||L>2?u:g,U=L<2?_:f;for(var A=0;A<=a;A++)y=Math.PI/2*(L+A/a),w=Math.cos(y),p=Math.sin(y),T.push(x+n*w,E+n*p,0),v.push(C+g*w,U+f*p),A<a&&(P=(a+1)*L+A+4,h.push(L,P,P+1))}return i.setIndex(new ye(new Uint32Array(h),1)),i.setAttribute("position",new ye(new Float32Array(T),3)),i.setAttribute("uv",new ye(new Float32Array(v),2)),i}return s}(Oi);function Br(e){for(var t=[],s=0;s<e.attributes.position.array.length/3;s++){var i=e.attributes.position.array[s*3+0],r=e.attributes.position.array[s*3+1],o=e.attributes.position.array[s*3+2];t.push(Math.atan2(i,o)/Math.PI*.5+.5,r/Math.PI*.5+.5)}return e.attributes.uv&&delete e.attributes.uv,e.setAttribute("uv",new Ze(t,2)),e.attributes.uv.needsUpdate=!0,e}function Yr(e){for(var t=[],s=[],i=0;i<e.attributes.position.array.length/3;i++){var r=e.attributes.position.array[i*3+0],o=e.attributes.position.array[i*3+1],n=e.attributes.position.array[i*3+2];s.push(new I(r,o,n))}for(var a=s.map(ks),l=0;l<a.length/3;l++)for(var m=new gi(s[l*3+0],s[l*3+1],s[l*3+2]),g=m.getNormal(new I),u=0;u<3;u++){var f=a[l*3+u];if(f.theta===0&&(f.phi===0||f.phi===Math.PI)){var _=f.phi===0?l*3+1:l*3+0;f={r:f.r,phi:f.phi,theta:a[_].theta}}f.theta===Math.PI&&ks(g).theta<Math.PI/2&&(f.theta=-Math.PI);var T=Zr(f);t.push(1-T.x,1-T.y)}return e.attributes.uv&&delete e.attributes.uv,e.setAttribute("uv",new Ze(t,2)),e.attributes.uv.needsUpdate=!0,e}function ks(e){var t=Math.sqrt(e.x*e.x+e.z*e.z+e.y*e.y);return{r:t,phi:Math.acos(e.y/t),theta:Math.atan2(e.z,e.x)}}function Zr(e){return{y:e.phi/Math.PI,x:(e.theta+Math.PI)/(2*Math.PI)}}function Nr(e){e.computeBoundingBox();var t=e.boundingBox.getSize(new I),s=Math.min(t.x,t.y,t.z),i=new Ei(s,s,s),r=new fe(i);r.rotation.set(0,0,0),r.updateWorldMatrix(!0,!1);var o=r.matrix.clone().invert(),n=new Ne(new I(-s/2,-s/2,-s/2),new I(s/2,s/2,s/2));return jr(e,o,n,s),e.attributes.uv.needsUpdate=!0,e}function jr(e,t,s,i){var r=[];r.length=2*e.attributes.position.array.length/3;var o=function(J,tt,ot){J.applyMatrix4(t),tt.applyMatrix4(t),ot.applyMatrix4(t);var F=new I;F.crossVectors(tt.clone().sub(J),tt.clone().sub(ot)).normalize(),F.x=Math.abs(F.x),F.y=Math.abs(F.y),F.z=Math.abs(F.z);var at=new ut,V=new ut,R=new ut;return F.y>F.x&&F.y>F.z?(at.x=(J.x-s.min.x)/i,at.y=(s.max.z-J.z)/i,V.x=(tt.x-s.min.x)/i,V.y=(s.max.z-tt.z)/i,R.x=(ot.x-s.min.x)/i,R.y=(s.max.z-ot.z)/i):F.x>F.y&&F.x>F.z?(at.x=(J.z-s.min.z)/i,at.y=(J.y-s.min.y)/i,V.x=(tt.z-s.min.z)/i,V.y=(tt.y-s.min.y)/i,R.x=(ot.z-s.min.z)/i,R.y=(ot.y-s.min.y)/i):F.z>F.y&&F.z>F.x&&(at.x=(J.x-s.min.x)/i,at.y=(J.y-s.min.y)/i,V.x=(tt.x-s.min.x)/i,V.y=(tt.y-s.min.y)/i,R.x=(ot.x-s.min.x)/i,R.y=(ot.y-s.min.y)/i),{uv0:at,uv1:V,uv2:R}};if(e.index)for(var n=0;n<e.index.array.length;n+=3){var a=e.index.array[n],l=e.index.array[n+1],m=e.index.array[n+2],g=e.attributes.position.array[3*a],u=e.attributes.position.array[3*a+1],f=e.attributes.position.array[3*a+2],_=e.attributes.position.array[3*l],T=e.attributes.position.array[3*l+1],v=e.attributes.position.array[3*l+2],O=e.attributes.position.array[3*m],h=e.attributes.position.array[3*m+1],y=e.attributes.position.array[3*m+2],w=new I(g,u,f),p=new I(_,T,v),x=new I(O,h,y),E=o(w,p,x);r[2*a]=E.uv0.x,r[2*a+1]=E.uv0.y,r[2*l]=E.uv1.x,r[2*l+1]=E.uv1.y,r[2*m]=E.uv2.x,r[2*m+1]=E.uv2.y}else for(var C=0;C<e.attributes.position.array.length;C+=9){var U=e.attributes.position.array[C],P=e.attributes.position.array[C+1],L=e.attributes.position.array[C+2],A=e.attributes.position.array[C+3],W=e.attributes.position.array[C+4],G=e.attributes.position.array[C+5],q=e.attributes.position.array[C+6],k=e.attributes.position.array[C+7],vt=e.attributes.position.array[C+8],N=new I(U,P,L),dt=new I(A,W,G),mt=new I(q,k,vt),K=o(N,dt,mt),X=C/3,ft=X+1,it=X+2;r[2*X]=K.uv0.x,r[2*X+1]=K.uv0.y,r[2*ft]=K.uv1.x,r[2*ft+1]=K.uv1.y,r[2*it]=K.uv2.x,r[2*it+1]=K.uv2.y}e.attributes.uv&&delete e.attributes.uv,e.setAttribute("uv",new Ze(r,2))}var Rn=Object.freeze({__proto__:null,RoundedPlaneGeometry:Vr,applyCylindricalUV:Br,applySphereUV:Yr,applyBoxUV:Nr});const qr=e=>(t,s,i)=>{const r=i.subscribe;return i.subscribe=(n,a,l)=>{let m=n;if(a){const g=(l==null?void 0:l.equalityFn)||Object.is;let u=n(i.getState());m=f=>{const _=n(f);if(!g(u,_)){const T=u;a(u=_,T)}},l!=null&&l.fireImmediately&&a(u,u)}return r(m)},e(t,s,i)},ei=c.createContext(null);function Dn({map:e,children:t,onChange:s,domElement:i}){const r=e.map(l=>l.name+l.keys).join("-"),o=c.useMemo(()=>Qs(qr(()=>e.reduce((l,m)=>({...l,[m.name]:!1}),{}))),[r]),n=c.useMemo(()=>[o.subscribe,o.getState,o],[r]),a=o.setState;return c.useEffect(()=>{const m=e.map(({name:_,keys:T,up:v})=>({keys:T,up:v,fn:O=>{a({[_]:O}),s&&s(_,O,n[1]())}})).reduce((_,{keys:T,fn:v,up:O=!0})=>(T.forEach(h=>_[h]={fn:v,pressed:!1,up:O}),_),{}),g=({key:_,code:T})=>{const v=m[_]||m[T];if(!v)return;const{fn:O,pressed:h,up:y}=v;v.pressed=!0,(y||!h)&&O(!0)},u=({key:_,code:T})=>{const v=m[_]||m[T];if(!v)return;const{fn:O,up:h}=v;v.pressed=!1,h&&O(!1)},f=i||window;return f.addEventListener("keydown",g,{passive:!0}),f.addEventListener("keyup",u,{passive:!0}),()=>{f.removeEventListener("keydown",g),f.removeEventListener("keyup",u)}},[i,r]),c.createElement(ei.Provider,{value:n,children:t})}function An(e){const[t,s,i]=c.useContext(ei);return e?i(e):[t,s]}const bn=c.forwardRef(({sdfGlyphSize:e=64,anchorX:t="center",anchorY:s="middle",font:i,fontSize:r=1,children:o,characters:n,onSync:a,...l},m)=>{const{Text:g,preloadFont:u}=be(async()=>Xi(()=>import("./troika-three-text.esm-DrKafjtB.js"),__vite__mapDeps([0,1])),[]),f=Y(({invalidate:O})=>O),[_]=c.useState(()=>new g),[T,v]=c.useMemo(()=>{const O=[];let h="";return c.Children.forEach(o,y=>{typeof y=="string"||typeof y=="number"?h+=y:O.push(y)}),[O,h]},[o]);return be(()=>new Promise(O=>u({font:i,characters:n},O)),["troika-text",i,n]),c.useLayoutEffect(()=>void _.sync(()=>{f(),a&&a(_)})),c.useEffect(()=>()=>_.dispose(),[_]),c.createElement("primitive",j({object:_,ref:m,font:i,text:v,anchorX:t,anchorY:s,fontSize:r,sdfGlyphSize:e},l),T)});let Oe=null;async function si(e){Oe||(Oe=new Hi);let t=typeof e=="string"?await(await fetch(e)).json():e;return Oe.parse(t)}function $e(e){return be(si,[e])}$e.preload=e=>Li(si,[e]);$e.clear=e=>Fi([e]);const Kr=["string","number"],Xr=e=>{let t="";const s=[];return c.Children.forEach(e,i=>{Kr.includes(typeof i)?t+=i+"":s.push(i)}),[t,...s]},Ln=c.forwardRef(({font:e,letterSpacing:t=0,lineHeight:s=1,size:i=1,height:r=.2,bevelThickness:o=.1,bevelSize:n=.01,bevelEnabled:a=!1,bevelOffset:l=0,bevelSegments:m=4,curveSegments:g=8,smooth:u,children:f,..._},T)=>{c.useMemo(()=>je({RenamedTextGeometry:Vi}),[]);const v=c.useRef(null),O=$e(e),h=c.useMemo(()=>({font:O,size:i,height:r,bevelThickness:o,bevelSize:n,bevelEnabled:a,bevelSegments:m,bevelOffset:l,curveSegments:g,letterSpacing:t,lineHeight:s}),[O,i,r,o,n,a,m,l,g,t,s]),[y,...w]=c.useMemo(()=>Xr(f),[f]),p=c.useMemo(()=>[y,h],[y,h]);return c.useLayoutEffect(()=>{u&&(v.current.geometry=Bi(v.current.geometry,u),v.current.geometry.computeVertexNormals())},[p,u]),c.useImperativeHandle(T,()=>v.current,[]),c.createElement("mesh",j({},_,{ref:v}),c.createElement("renamedTextGeometry",{args:p}),w)});function Wr(e,t,s,i){const r=class extends yt{constructor(n={}){const a=Object.entries(e);super({uniforms:a.reduce((l,[m,g])=>{const u=Ti.clone({[m]:{value:g}});return{...l,...u}},{}),vertexShader:t,fragmentShader:s}),this.key="",a.forEach(([l])=>Object.defineProperty(this,l,{get:()=>this.uniforms[l].value,set:m=>this.uniforms[l].value=m})),Object.assign(this,n),i&&i(this)}};return r.key=$s.generateUUID(),r}const $r=()=>parseInt(xi.replace(/\D+/g,"")),ii=$r();function Qr(e,{keys:t=["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData","bindMode","bindMatrix","bindMatrixInverse","skeleton"],deep:s,inject:i,castShadow:r,receiveShadow:o}){let n={};for(const a of t)n[a]=e[a];return s&&(n.geometry&&s!=="materialsOnly"&&(n.geometry=n.geometry.clone()),n.material&&s!=="geometriesOnly"&&(n.material=n.material.clone())),i&&(typeof i=="function"?n={...n,children:i(e)}:c.isValidElement(i)?n={...n,children:i}:n={...n,...i}),e instanceof fe&&(r&&(n.castShadow=!0),o&&(n.receiveShadow=!0)),n}const ke=c.forwardRef(({isChild:e=!1,object:t,children:s,deep:i,castShadow:r,receiveShadow:o,inject:n,keys:a,...l},m)=>{const g={keys:a,deep:i,inject:n,castShadow:r,receiveShadow:o};if(t=c.useMemo(()=>{if(e===!1&&!Array.isArray(t)){let T=!1;if(t.traverse(v=>{v.isSkinnedMesh&&(T=!0)}),T)return Yi.clone(t)}return t},[t,e]),Array.isArray(t))return c.createElement("group",j({},l,{ref:m}),t.map(T=>c.createElement(ke,j({key:T.uuid,object:T},g))),s);const{children:u,...f}=Qr(t,g),_=t.type[0].toLowerCase()+t.type.slice(1);return c.createElement(_,j({},f,l,{ref:m}),t.children.map(T=>T.type==="Bone"?c.createElement("primitive",j({key:T.uuid,object:T},g)):c.createElement(ke,j({key:T.uuid,object:T},g,{isChild:!0}))),s,u)});let re=null,ri="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function ni(e,t,s){return i=>{s&&s(i),e&&(re||(re=new Zi),re.setDecoderPath(typeof e=="string"?e:ri),i.setDRACOLoader(re)),t&&i.setMeshoptDecoder(typeof ge=="function"?ge():ge)}}function pe(e,t=!0,s=!0,i){return qe(Ke,e,ni(t,s,i))}pe.preload=(e,t=!0,s=!0,i)=>qe.preload(Ke,e,ni(t,s,i));pe.clear=e=>qe.clear(Ke,e);pe.setDecoderPath=e=>{ri=e};const zn=c.forwardRef(({src:e,...t},s)=>{const{scene:i}=pe(e);return c.createElement(ke,j({ref:s},t,{object:i}))});function me(e,t,s){const i=Y(f=>f.size),r=Y(f=>f.viewport),o=typeof e=="number"?e:i.width*r.dpr,n=typeof t=="number"?t:i.height*r.dpr,a=(typeof e=="number"?s:e)||{},{samples:l=0,depth:m,...g}=a,u=c.useMemo(()=>{const f=new ht(o,n,{minFilter:De,magFilter:De,type:wi,...g});return m&&(f.depthTexture=new Ci(o,n,he)),f.samples=l,f},[]);return c.useLayoutEffect(()=>{u.setSize(o,n),l&&(u.samples=l)},[l,u,o,n]),c.useEffect(()=>()=>u.dispose(),[]),u}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const H={LEFT:1,RIGHT:2,MIDDLE:4},d=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Pt={NONE:0,IN:1,OUT:-1};function wt(e){return e.isPerspectiveCamera}function gt(e){return e.isOrthographicCamera}const Rt=Math.PI*2,Hs=Math.PI/2,oi=1e-5,qt=Math.PI/180;function nt(e,t,s){return Math.max(t,Math.min(s,e))}function z(e,t=oi){return Math.abs(e)<t}function b(e,t,s=oi){return z(e-t,s)}function Vs(e,t){return Math.round(e/t)*t}function Kt(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Xt(e){return Math.abs(e)<Number.MAX_VALUE?e:e*(1/0)}function ne(e,t,s,i,r=1/0,o){i=Math.max(1e-4,i);const n=2/i,a=n*o,l=1/(1+a+.48*a*a+.235*a*a*a);let m=e-t;const g=t,u=r*i;m=nt(m,-u,u),t=e-m;const f=(s.value+n*m)*o;s.value=(s.value-n*f)*l;let _=t+(m+f)*l;return g-e>0==_>g&&(_=g,s.value=(_-g)/o),_}function Bs(e,t,s,i,r=1/0,o,n){i=Math.max(1e-4,i);const a=2/i,l=a*o,m=1/(1+l+.48*l*l+.235*l*l*l);let g=t.x,u=t.y,f=t.z,_=e.x-g,T=e.y-u,v=e.z-f;const O=g,h=u,y=f,w=r*i,p=w*w,x=_*_+T*T+v*v;if(x>p){const k=Math.sqrt(x);_=_/k*w,T=T/k*w,v=v/k*w}g=e.x-_,u=e.y-T,f=e.z-v;const E=(s.x+a*_)*o,C=(s.y+a*T)*o,U=(s.z+a*v)*o;s.x=(s.x-a*E)*m,s.y=(s.y-a*C)*m,s.z=(s.z-a*U)*m,n.x=g+(_+E)*m,n.y=u+(T+C)*m,n.z=f+(v+U)*m;const P=O-e.x,L=h-e.y,A=y-e.z,W=n.x-O,G=n.y-h,q=n.z-y;return P*W+L*G+A*q>0&&(n.x=O,n.y=h,n.z=y,s.x=(n.x-O)/o,s.y=(n.y-h)/o,s.z=(n.z-y)/o),n}function Te(e,t){t.set(0,0),e.forEach(s=>{t.x+=s.clientX,t.y+=s.clientY}),t.x/=e.length,t.y/=e.length}function xe(e,t){return gt(e)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class Gr{constructor(){this._listeners={}}addEventListener(t,s){const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(s)===-1&&i[t].push(s)}hasEventListener(t,s){const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(s)!==-1}removeEventListener(t,s){const r=this._listeners[t];if(r!==void 0){const o=r.indexOf(s);o!==-1&&r.splice(o,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const i=this._listeners[t.type];if(i!==void 0){t.target=this;const r=i.slice(0);for(let o=0,n=r.length;o<n;o++)r[o].call(this,t)}}}var we;const Jr="2.8.3",oe=1/8,tn=/Mac/.test((we=globalThis==null?void 0:globalThis.navigator)===null||we===void 0?void 0:we.platform);let M,Ys,ae,Ce,Q,S,D,Dt,Wt,lt,ct,Ct,Zs,Ns,st,$t,At,js,Me,qs,Ue,Se,le,Pe=class He extends Gr{static install(t){M=t.THREE,Ys=Object.freeze(new M.Vector3(0,0,0)),ae=Object.freeze(new M.Vector3(0,1,0)),Ce=Object.freeze(new M.Vector3(0,0,1)),Q=new M.Vector2,S=new M.Vector3,D=new M.Vector3,Dt=new M.Vector3,Wt=new M.Vector3,lt=new M.Vector3,ct=new M.Vector3,Ct=new M.Vector3,Zs=new M.Vector3,Ns=new M.Vector3,st=new M.Spherical,$t=new M.Spherical,At=new M.Box3,js=new M.Box3,Me=new M.Sphere,qs=new M.Quaternion,Ue=new M.Quaternion,Se=new M.Matrix4,le=new M.Raycaster}static get ACTION(){return d}constructor(t,s){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=d.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Pt.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new M.Vector3,this._focalOffsetVelocity=new M.Vector3,this._zoomVelocity={value:0},this._truckInternal=(h,y,w)=>{let p,x;if(wt(this._camera)){const E=S.copy(this._camera.position).sub(this._target),C=this._camera.getEffectiveFOV()*qt,U=E.length()*Math.tan(C*.5);p=this.truckSpeed*h*U/this._elementRect.height,x=this.truckSpeed*y*U/this._elementRect.height}else if(gt(this._camera)){const E=this._camera;p=h*(E.right-E.left)/E.zoom/this._elementRect.width,x=y*(E.top-E.bottom)/E.zoom/this._elementRect.height}else return;this.verticalDragToForward?(w?this.setFocalOffset(this._focalOffsetEnd.x+p,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(p,0,!0),this.forward(-x,!0)):w?this.setFocalOffset(this._focalOffsetEnd.x+p,this._focalOffsetEnd.y+x,this._focalOffsetEnd.z,!0):this.truck(p,x,!0)},this._rotateInternal=(h,y)=>{const w=Rt*this.azimuthRotateSpeed*h/this._elementRect.height,p=Rt*this.polarRotateSpeed*y/this._elementRect.height;this.rotate(w,p,!0)},this._dollyInternal=(h,y,w)=>{const p=Math.pow(.95,-h*this.dollySpeed),x=this._sphericalEnd.radius,E=this._sphericalEnd.radius*p,C=nt(E,this.minDistance,this.maxDistance),U=C-E;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(E,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(U,!0),this._dollyToNoClamp(C,!0)):this._dollyToNoClamp(C,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?E:C)-x,this._dollyControlCoord.set(y,w)),this._lastDollyDirection=Math.sign(-h)},this._zoomInternal=(h,y,w)=>{const p=Math.pow(.95,h*this.dollySpeed),x=this._zoom,E=this._zoom*p;this.zoomTo(E,!0),this.dollyToCursor&&(this._changedZoom+=E-x,this._dollyControlCoord.set(y,w))},typeof M>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new M.Quaternion().setFromUnitVectors(this._camera.up,ae),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=d.NONE,this._target=new M.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new M.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new M.Spherical().setFromVector3(S.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new M.Vector3,new M.Vector3,new M.Vector3,new M.Vector3],this._updateNearPlaneCorners(),this._boundary=new M.Box3(new M.Vector3(-1/0,-1/0,-1/0),new M.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new M.Vector2,this.mouseButtons={left:d.ROTATE,middle:d.DOLLY,right:d.TRUCK,wheel:wt(this._camera)?d.DOLLY:gt(this._camera)?d.ZOOM:d.NONE},this.touches={one:d.TOUCH_ROTATE,two:wt(this._camera)?d.TOUCH_DOLLY_TRUCK:gt(this._camera)?d.TOUCH_ZOOM_TRUCK:d.NONE,three:d.TOUCH_TRUCK};const i=new M.Vector2,r=new M.Vector2,o=new M.Vector2,n=h=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const p=this._domElement.getBoundingClientRect(),x=h.clientX/p.width,E=h.clientY/p.height;if(x<this._interactiveArea.left||x>this._interactiveArea.right||E<this._interactiveArea.top||E>this._interactiveArea.bottom)return}const y=h.pointerType!=="mouse"?null:(h.buttons&H.LEFT)===H.LEFT?H.LEFT:(h.buttons&H.MIDDLE)===H.MIDDLE?H.MIDDLE:(h.buttons&H.RIGHT)===H.RIGHT?H.RIGHT:null;if(y!==null){const p=this._findPointerByMouseButton(y);p&&this._disposePointer(p)}if((h.buttons&H.LEFT)===H.LEFT&&this._lockedPointer)return;const w={pointerId:h.pointerId,clientX:h.clientX,clientY:h.clientY,deltaX:0,deltaY:0,mouseButton:y};this._activePointers.push(w),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,f(h)},a=h=>{h.cancelable&&h.preventDefault();const y=h.pointerId,w=this._lockedPointer||this._findPointerById(y);if(w){if(w.clientX=h.clientX,w.clientY=h.clientY,w.deltaX=h.movementX,w.deltaY=h.movementY,this._state=0,h.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(h.buttons&H.LEFT)===H.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(h.buttons&H.MIDDLE)===H.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(h.buttons&H.RIGHT)===H.RIGHT&&(this._state=this._state|this.mouseButtons.right);_()}},l=h=>{const y=this._findPointerById(h.pointerId);if(!(y&&y===this._lockedPointer)){if(y&&this._disposePointer(y),h.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=d.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=d.NONE;T()}};let m=-1;const g=h=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===d.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const E=this._domElement.getBoundingClientRect(),C=h.clientX/E.width,U=h.clientY/E.height;if(C<this._interactiveArea.left||C>this._interactiveArea.right||U<this._interactiveArea.top||U>this._interactiveArea.bottom)return}if(h.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===d.ROTATE||this.mouseButtons.wheel===d.TRUCK){const E=performance.now();m-E<1e3&&this._getClientRect(this._elementRect),m=E}const y=tn?-1:-3,w=h.deltaMode===1?h.deltaY/y:h.deltaY/(y*10),p=this.dollyToCursor?(h.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,x=this.dollyToCursor?(h.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case d.ROTATE:{this._rotateInternal(h.deltaX,h.deltaY),this._isUserControllingRotate=!0;break}case d.TRUCK:{this._truckInternal(h.deltaX,h.deltaY,!1),this._isUserControllingTruck=!0;break}case d.OFFSET:{this._truckInternal(h.deltaX,h.deltaY,!0),this._isUserControllingOffset=!0;break}case d.DOLLY:{this._dollyInternal(-w,p,x),this._isUserControllingDolly=!0;break}case d.ZOOM:{this._zoomInternal(-w,p,x),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},u=h=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===He.ACTION.NONE){const y=h instanceof PointerEvent?h.pointerId:0,w=this._findPointerById(y);w&&this._disposePointer(w),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}h.preventDefault()}},f=h=>{if(!this._enabled)return;if(Te(this._activePointers,Q),this._getClientRect(this._elementRect),i.copy(Q),r.copy(Q),this._activePointers.length>=2){const w=Q.x-this._activePointers[1].clientX,p=Q.y-this._activePointers[1].clientY,x=Math.sqrt(w*w+p*p);o.set(0,x);const E=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,C=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;r.set(E,C)}if(this._state=0,!h)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in h&&h.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(h.buttons&H.LEFT)===H.LEFT&&(this._state=this._state|this.mouseButtons.left),(h.buttons&H.MIDDLE)===H.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(h.buttons&H.RIGHT)===H.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&d.ROTATE)===d.ROTATE||(this._state&d.TOUCH_ROTATE)===d.TOUCH_ROTATE||(this._state&d.TOUCH_DOLLY_ROTATE)===d.TOUCH_DOLLY_ROTATE||(this._state&d.TOUCH_ZOOM_ROTATE)===d.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&d.TRUCK)===d.TRUCK||(this._state&d.TOUCH_TRUCK)===d.TOUCH_TRUCK||(this._state&d.TOUCH_DOLLY_TRUCK)===d.TOUCH_DOLLY_TRUCK||(this._state&d.TOUCH_ZOOM_TRUCK)===d.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&d.DOLLY)===d.DOLLY||(this._state&d.TOUCH_DOLLY)===d.TOUCH_DOLLY||(this._state&d.TOUCH_DOLLY_TRUCK)===d.TOUCH_DOLLY_TRUCK||(this._state&d.TOUCH_DOLLY_OFFSET)===d.TOUCH_DOLLY_OFFSET||(this._state&d.TOUCH_DOLLY_ROTATE)===d.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&d.ZOOM)===d.ZOOM||(this._state&d.TOUCH_ZOOM)===d.TOUCH_ZOOM||(this._state&d.TOUCH_ZOOM_TRUCK)===d.TOUCH_ZOOM_TRUCK||(this._state&d.TOUCH_ZOOM_OFFSET)===d.TOUCH_ZOOM_OFFSET||(this._state&d.TOUCH_ZOOM_ROTATE)===d.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&d.OFFSET)===d.OFFSET||(this._state&d.TOUCH_OFFSET)===d.TOUCH_OFFSET||(this._state&d.TOUCH_DOLLY_OFFSET)===d.TOUCH_DOLLY_OFFSET||(this._state&d.TOUCH_ZOOM_OFFSET)===d.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},_=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Te(this._activePointers,Q);const y=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,w=y?-y.deltaX:r.x-Q.x,p=y?-y.deltaY:r.y-Q.y;if(r.copy(Q),((this._state&d.ROTATE)===d.ROTATE||(this._state&d.TOUCH_ROTATE)===d.TOUCH_ROTATE||(this._state&d.TOUCH_DOLLY_ROTATE)===d.TOUCH_DOLLY_ROTATE||(this._state&d.TOUCH_ZOOM_ROTATE)===d.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(w,p),this._isUserControllingRotate=!0),(this._state&d.DOLLY)===d.DOLLY||(this._state&d.ZOOM)===d.ZOOM){const x=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,E=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0,C=this.dollyDragInverted?-1:1;(this._state&d.DOLLY)===d.DOLLY?(this._dollyInternal(C*p*oe,x,E),this._isUserControllingDolly=!0):(this._zoomInternal(C*p*oe,x,E),this._isUserControllingZoom=!0)}if((this._state&d.TOUCH_DOLLY)===d.TOUCH_DOLLY||(this._state&d.TOUCH_ZOOM)===d.TOUCH_ZOOM||(this._state&d.TOUCH_DOLLY_TRUCK)===d.TOUCH_DOLLY_TRUCK||(this._state&d.TOUCH_ZOOM_TRUCK)===d.TOUCH_ZOOM_TRUCK||(this._state&d.TOUCH_DOLLY_OFFSET)===d.TOUCH_DOLLY_OFFSET||(this._state&d.TOUCH_ZOOM_OFFSET)===d.TOUCH_ZOOM_OFFSET||(this._state&d.TOUCH_DOLLY_ROTATE)===d.TOUCH_DOLLY_ROTATE||(this._state&d.TOUCH_ZOOM_ROTATE)===d.TOUCH_ZOOM_ROTATE){const x=Q.x-this._activePointers[1].clientX,E=Q.y-this._activePointers[1].clientY,C=Math.sqrt(x*x+E*E),U=o.y-C;o.set(0,C);const P=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,L=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&d.TOUCH_DOLLY)===d.TOUCH_DOLLY||(this._state&d.TOUCH_DOLLY_ROTATE)===d.TOUCH_DOLLY_ROTATE||(this._state&d.TOUCH_DOLLY_TRUCK)===d.TOUCH_DOLLY_TRUCK||(this._state&d.TOUCH_DOLLY_OFFSET)===d.TOUCH_DOLLY_OFFSET?(this._dollyInternal(U*oe,P,L),this._isUserControllingDolly=!0):(this._zoomInternal(U*oe,P,L),this._isUserControllingZoom=!0)}((this._state&d.TRUCK)===d.TRUCK||(this._state&d.TOUCH_TRUCK)===d.TOUCH_TRUCK||(this._state&d.TOUCH_DOLLY_TRUCK)===d.TOUCH_DOLLY_TRUCK||(this._state&d.TOUCH_ZOOM_TRUCK)===d.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(w,p,!1),this._isUserControllingTruck=!0),((this._state&d.OFFSET)===d.OFFSET||(this._state&d.TOUCH_OFFSET)===d.TOUCH_OFFSET||(this._state&d.TOUCH_DOLLY_OFFSET)===d.TOUCH_DOLLY_OFFSET||(this._state&d.TOUCH_ZOOM_OFFSET)===d.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(w,p,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},T=()=>{Te(this._activePointers,Q),r.copy(Q),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",v),this._domElement.ownerDocument.addEventListener("pointerlockerror",O),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),f())},this.unlockPointer=()=>{var h,y,w;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(h=this._domElement)===null||h===void 0||h.ownerDocument.exitPointerLock(),(y=this._domElement)===null||y===void 0||y.ownerDocument.removeEventListener("pointerlockchange",v),(w=this._domElement)===null||w===void 0||w.ownerDocument.removeEventListener("pointerlockerror",O),this.cancel()};const v=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},O=()=>{this.unlockPointer()};this._addAllEventListeners=h=>{this._domElement=h,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",n),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",g,{passive:!1}),this._domElement.addEventListener("contextmenu",u)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",n),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",g,{passive:!1}),this._domElement.removeEventListener("contextmenu",u),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",O))},this.cancel=()=>{this._state!==d.NONE&&(this._state=d.NONE,this._activePointers.length=0,T())},s&&this.connect(s),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=nt(t.width,0,1),this._interactiveArea.height=nt(t.height,0,1),this._interactiveArea.x=nt(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=nt(t.y,0,1-this._interactiveArea.height)}addEventListener(t,s){super.addEventListener(t,s)}removeEventListener(t,s){super.removeEventListener(t,s)}rotate(t,s,i=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+s,i)}rotateAzimuthTo(t,s=!1){return this.rotateTo(t,this._sphericalEnd.phi,s)}rotatePolarTo(t,s=!1){return this.rotateTo(this._sphericalEnd.theta,t,s)}rotateTo(t,s,i=!1){this._isUserControllingRotate=!1;const r=nt(t,this.minAzimuthAngle,this.maxAzimuthAngle),o=nt(s,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=o,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const n=!i||b(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&b(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(n)}dolly(t,s=!1){return this.dollyTo(this._sphericalEnd.radius-t,s)}dollyTo(t,s=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Pt.NONE,this._changedDolly=0,this._dollyToNoClamp(nt(t,this.minDistance,this.maxDistance),s)}_dollyToNoClamp(t,s=!1){const i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const n=this._collisionTest(),a=b(n,this._spherical.radius);if(!(i>t)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,n)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,s||(this._spherical.radius=this._sphericalEnd.radius);const o=!s||b(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(o)}dollyInFixed(t,s=!1){this._targetEnd.add(this._getCameraDirection(Wt).multiplyScalar(t)),s||this._target.copy(this._targetEnd);const i=!s||b(this._target.x,this._targetEnd.x,this.restThreshold)&&b(this._target.y,this._targetEnd.y,this.restThreshold)&&b(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(t,s=!1){return this.zoomTo(this._zoomEnd+t,s)}zoomTo(t,s=!1){this._isUserControllingZoom=!1,this._zoomEnd=nt(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,s||(this._zoom=this._zoomEnd);const i=!s||b(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(t,s,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,s,i)}truck(t,s,i=!1){this._camera.updateMatrix(),lt.setFromMatrixColumn(this._camera.matrix,0),ct.setFromMatrixColumn(this._camera.matrix,1),lt.multiplyScalar(t),ct.multiplyScalar(-s);const r=S.copy(lt).add(ct),o=D.copy(this._targetEnd).add(r);return this.moveTo(o.x,o.y,o.z,i)}forward(t,s=!1){S.setFromMatrixColumn(this._camera.matrix,0),S.crossVectors(this._camera.up,S),S.multiplyScalar(t);const i=D.copy(this._targetEnd).add(S);return this.moveTo(i.x,i.y,i.z,s)}elevate(t,s=!1){return S.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+S.x,this._targetEnd.y+S.y,this._targetEnd.z+S.z,s)}moveTo(t,s,i,r=!1){this._isUserControllingTruck=!1;const o=S.set(t,s,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,o,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);const n=!r||b(this._target.x,this._targetEnd.x,this.restThreshold)&&b(this._target.y,this._targetEnd.y,this.restThreshold)&&b(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}lookInDirectionOf(t,s,i,r=!1){const a=S.set(t,s,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,r)}fitToBox(t,s,{cover:i=!1,paddingLeft:r=0,paddingRight:o=0,paddingBottom:n=0,paddingTop:a=0}={}){const l=[],m=t.isBox3?At.copy(t):At.setFromObject(t);m.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const g=Vs(this._sphericalEnd.theta,Hs),u=Vs(this._sphericalEnd.phi,Hs);l.push(this.rotateTo(g,u,s));const f=S.setFromSpherical(this._sphericalEnd).normalize(),_=qs.setFromUnitVectors(f,Ce),T=b(Math.abs(f.y),1);T&&_.multiply(Ue.setFromAxisAngle(ae,g)),_.multiply(this._yAxisUpSpaceInverse);const v=js.makeEmpty();D.copy(m.min).applyQuaternion(_),v.expandByPoint(D),D.copy(m.min).setX(m.max.x).applyQuaternion(_),v.expandByPoint(D),D.copy(m.min).setY(m.max.y).applyQuaternion(_),v.expandByPoint(D),D.copy(m.max).setZ(m.min.z).applyQuaternion(_),v.expandByPoint(D),D.copy(m.min).setZ(m.max.z).applyQuaternion(_),v.expandByPoint(D),D.copy(m.max).setY(m.min.y).applyQuaternion(_),v.expandByPoint(D),D.copy(m.max).setX(m.min.x).applyQuaternion(_),v.expandByPoint(D),D.copy(m.max).applyQuaternion(_),v.expandByPoint(D),v.min.x-=r,v.min.y-=n,v.max.x+=o,v.max.y+=a,_.setFromUnitVectors(Ce,f),T&&_.premultiply(Ue.invert()),_.premultiply(this._yAxisUpSpace);const O=v.getSize(S),h=v.getCenter(D).applyQuaternion(_);if(wt(this._camera)){const y=this.getDistanceToFitBox(O.x,O.y,O.z,i);l.push(this.moveTo(h.x,h.y,h.z,s)),l.push(this.dollyTo(y,s)),l.push(this.setFocalOffset(0,0,0,s))}else if(gt(this._camera)){const y=this._camera,w=y.right-y.left,p=y.top-y.bottom,x=i?Math.max(w/O.x,p/O.y):Math.min(w/O.x,p/O.y);l.push(this.moveTo(h.x,h.y,h.z,s)),l.push(this.zoomTo(x,s)),l.push(this.setFocalOffset(0,0,0,s))}return Promise.all(l)}fitToSphere(t,s){const i=[],o=t instanceof M.Sphere?Me.copy(t):He.createBoundingSphere(t,Me);if(i.push(this.moveTo(o.center.x,o.center.y,o.center.z,s)),wt(this._camera)){const n=this.getDistanceToFitSphere(o.radius);i.push(this.dollyTo(n,s))}else if(gt(this._camera)){const n=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,l=2*o.radius,m=Math.min(n/l,a/l);i.push(this.zoomTo(m,s))}return i.push(this.setFocalOffset(0,0,0,s)),Promise.all(i)}setLookAt(t,s,i,r,o,n,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Pt.NONE,this._changedDolly=0;const l=D.set(r,o,n),m=S.set(t,s,i);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(m.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const g=!a||b(this._target.x,this._targetEnd.x,this.restThreshold)&&b(this._target.y,this._targetEnd.y,this.restThreshold)&&b(this._target.z,this._targetEnd.z,this.restThreshold)&&b(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&b(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&b(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(g)}lerpLookAt(t,s,i,r,o,n,a,l,m,g,u,f,_,T=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Pt.NONE,this._changedDolly=0;const v=S.set(r,o,n),O=D.set(t,s,i);st.setFromVector3(O.sub(v).applyQuaternion(this._yAxisUpSpace));const h=Dt.set(g,u,f),y=D.set(a,l,m);$t.setFromVector3(y.sub(h).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(v.lerp(h,_));const w=$t.theta-st.theta,p=$t.phi-st.phi,x=$t.radius-st.radius;this._sphericalEnd.set(st.radius+x*_,st.phi+p*_,st.theta+w*_),this.normalizeRotations(),this._needsUpdate=!0,T||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const E=!T||b(this._target.x,this._targetEnd.x,this.restThreshold)&&b(this._target.y,this._targetEnd.y,this.restThreshold)&&b(this._target.z,this._targetEnd.z,this.restThreshold)&&b(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&b(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&b(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(E)}setPosition(t,s,i,r=!1){return this.setLookAt(t,s,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(t,s,i,r=!1){const o=this.getPosition(S),n=this.setLookAt(o.x,o.y,o.z,t,s,i,r);return this._sphericalEnd.phi=nt(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),n}setFocalOffset(t,s,i,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,s,i),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);const o=!r||b(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&b(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&b(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}setOrbitPoint(t,s,i){this._camera.updateMatrixWorld(),lt.setFromMatrixColumn(this._camera.matrixWorldInverse,0),ct.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Ct.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const r=S.set(t,s,i),o=r.distanceTo(this._camera.position),n=r.sub(this._camera.position);lt.multiplyScalar(n.x),ct.multiplyScalar(n.y),Ct.multiplyScalar(n.z),S.copy(lt).add(ct).add(Ct),S.z=S.z+o,this.dollyTo(o,!1),this.setFocalOffset(-S.x,S.y,-S.z,!1),this.moveTo(t,s,i,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,s,i,r){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new M.Vector4,typeof t=="number"?this._viewport.set(t,s,i,r):this._viewport.copy(t)}getDistanceToFitBox(t,s,i,r=!1){if(xe(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const o=t/s,n=this._camera.getEffectiveFOV()*qt,a=this._camera.aspect;return((r?o>a:o<a)?s:t/a)*.5/Math.tan(n*.5)+i*.5}getDistanceToFitSphere(t){if(xe(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const s=this._camera.getEffectiveFOV()*qt,i=Math.atan(Math.tan(s*.5)*this._camera.aspect)*2,r=1<this._camera.aspect?s:i;return t/Math.sin(r*.5)}getTarget(t,s=!0){return(t&&t.isVector3?t:new M.Vector3).copy(s?this._targetEnd:this._target)}getPosition(t,s=!0){return(t&&t.isVector3?t:new M.Vector3).setFromSpherical(s?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(s?this._targetEnd:this._target)}getSpherical(t,s=!0){return(t&&t instanceof M.Spherical?t:new M.Spherical).copy(s?this._sphericalEnd:this._spherical)}getFocalOffset(t,s=!0){return(t&&t.isVector3?t:new M.Vector3).copy(s?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Rt,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Rt),this._spherical.theta+=Rt*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Rt)}reset(t=!1){if(!b(this._camera.up.x,this._cameraUp0.x)||!b(this._camera.up.y,this._cameraUp0.y)||!b(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const i=this.getPosition(S);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}const s=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(s)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,ae),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=S.subVectors(this._target,this._camera.position).normalize(),s=D.crossVectors(t,this._camera.up);this._camera.up.crossVectors(s,t).normalize(),this._camera.updateMatrixWorld();const i=this.getPosition(S);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(t){const s=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,o=Zs.subVectors(this._targetEnd,this._target),n=Ns.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(z(s))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const u=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=ne(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,u,1/0,t),this._needsUpdate=!0}if(z(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const u=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=ne(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,u,1/0,t),this._needsUpdate=!0}if(z(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const u=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=ne(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,u,this.maxSpeed,t),this._needsUpdate=!0}if(z(o.x)&&z(o.y)&&z(o.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const u=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Bs(this._target,this._targetEnd,this._targetVelocity,u,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(z(n.x)&&z(n.y)&&z(n.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const u=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Bs(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,u,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(z(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const u=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=ne(this._zoom,this._zoomEnd,this._zoomVelocity,u,1/0,t)}if(this.dollyToCursor){if(wt(this._camera)&&this._changedDolly!==0){const u=this._spherical.radius-this._lastDistance,f=this._camera,_=this._getCameraDirection(Wt),T=S.copy(_).cross(f.up).normalize();T.lengthSq()===0&&(T.x=1);const v=D.crossVectors(T,_),O=this._sphericalEnd.radius*Math.tan(f.getEffectiveFOV()*qt*.5),y=(this._sphericalEnd.radius-u-this._sphericalEnd.radius)/this._sphericalEnd.radius,w=Dt.copy(this._targetEnd).add(T.multiplyScalar(this._dollyControlCoord.x*O*f.aspect)).add(v.multiplyScalar(this._dollyControlCoord.y*O)),p=S.copy(this._targetEnd).lerp(w,y),x=this._lastDollyDirection===Pt.IN&&this._spherical.radius<=this.minDistance,E=this._lastDollyDirection===Pt.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(x||E)){this._sphericalEnd.radius-=u,this._spherical.radius-=u;const U=D.copy(_).multiplyScalar(-u);p.add(U)}this._boundary.clampPoint(p,p);const C=D.subVectors(p,this._targetEnd);this._targetEnd.copy(p),this._target.add(C),this._changedDolly-=u,z(this._changedDolly)&&(this._changedDolly=0)}else if(gt(this._camera)&&this._changedZoom!==0){const u=this._zoom-this._lastZoom,f=this._camera,_=S.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(f.near+f.far)/(f.near-f.far)).unproject(f),T=D.set(0,0,-1).applyQuaternion(f.quaternion),v=Dt.copy(_).add(T.multiplyScalar(-_.dot(f.up))),h=-(this._zoom-u-this._zoom)/this._zoom,y=this._getCameraDirection(Wt),w=this._targetEnd.dot(y),p=S.copy(this._targetEnd).lerp(v,h),x=p.dot(y),E=y.multiplyScalar(x-w);p.sub(E),this._boundary.clampPoint(p,p);const C=D.subVectors(p,this._targetEnd);this._targetEnd.copy(p),this._target.add(C),this._changedZoom-=u,z(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!z(this._focalOffset.x)||!z(this._focalOffset.y)||!z(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),lt.setFromMatrixColumn(this._camera.matrix,0),ct.setFromMatrixColumn(this._camera.matrix,1),Ct.setFromMatrixColumn(this._camera.matrix,2),lt.multiplyScalar(this._focalOffset.x),ct.multiplyScalar(-this._focalOffset.y),Ct.multiplyScalar(this._focalOffset.z),S.copy(lt).add(ct).add(Ct),this._camera.position.add(S)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),S.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const g=this._needsUpdate;return g&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):g?(this.dispatchEvent({type:"update"}),z(s,this.restThreshold)&&z(i,this.restThreshold)&&z(r,this.restThreshold)&&z(o.x,this.restThreshold)&&z(o.y,this.restThreshold)&&z(o.z,this.restThreshold)&&z(n.x,this.restThreshold)&&z(n.y,this.restThreshold)&&z(n.z,this.restThreshold)&&z(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!g&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=g,this._needsUpdate=!1,g}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Kt(this.maxDistance),minZoom:this.minZoom,maxZoom:Kt(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Kt(this.maxPolarAngle),minAzimuthAngle:Kt(this.minAzimuthAngle),maxAzimuthAngle:Kt(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:S.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,s=!1){const i=JSON.parse(t);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=Xt(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=Xt(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=Xt(i.maxPolarAngle),this.minAzimuthAngle=Xt(i.minAzimuthAngle),this.maxAzimuthAngle=Xt(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],s),st.setFromVector3(S.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(st.theta,st.phi,s),this.dollyTo(st.radius,s),this.zoomTo(i.zoom,s),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],s),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",Jr),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(s=>s.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(s=>s.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,s,i){const r=s.lengthSq();if(r===0)return t;const o=D.copy(s).add(t),a=this._boundary.clampPoint(o,Dt).sub(o),l=a.lengthSq();if(l===0)return t.add(s);if(l===r)return t;if(i===0)return t.add(s).add(a);{const m=1+i*l/s.dot(a);return t.add(D.copy(s).multiplyScalar(m)).add(a.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(wt(this._camera)){const t=this._camera,s=t.near,i=t.getEffectiveFOV()*qt,r=Math.tan(i*.5)*s,o=r*t.aspect;this._nearPlaneCorners[0].set(-o,-r,0),this._nearPlaneCorners[1].set(o,-r,0),this._nearPlaneCorners[2].set(o,r,0),this._nearPlaneCorners[3].set(-o,r,0)}else if(gt(this._camera)){const t=this._camera,s=1/t.zoom,i=t.left*s,r=t.right*s,o=t.top*s,n=t.bottom*s;this._nearPlaneCorners[0].set(i,o,0),this._nearPlaneCorners[1].set(r,o,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(i,n,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||xe(this._camera,"_collisionTest"))return t;const i=this._getTargetDirection(Wt);Se.lookAt(Ys,i,this._camera.up);for(let r=0;r<4;r++){const o=D.copy(this._nearPlaneCorners[r]);o.applyMatrix4(Se);const n=Dt.addVectors(this._target,o);le.set(n,i),le.far=this._spherical.radius+1;const a=le.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<t&&(t=a[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const s=this._domElement.getBoundingClientRect();return t.x=s.left,t.y=s.top,this._viewport?(t.x+=this._viewport.x,t.y+=s.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=s.width,t.height=s.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(s=>{const i=()=>{this.removeEventListener("rest",i),s()};this.addEventListener("rest",i)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,s=new M.Sphere){const i=s,r=i.center;At.makeEmpty(),t.traverseVisible(n=>{n.isMesh&&At.expandByObject(n)}),At.getCenter(r);let o=0;return t.traverseVisible(n=>{if(!n.isMesh)return;const a=n,l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const g=l.attributes.position;for(let u=0,f=g.count;u<f;u++)S.fromBufferAttribute(g,u),o=Math.max(o,r.distanceToSquared(S))}),i.radius=Math.sqrt(o),i}};const In=c.forwardRef((e,t)=>{c.useMemo(()=>{const x={Box3:Ne,MathUtils:{clamp:$s.clamp},Matrix4:Ye,Quaternion:zt,Raycaster:Mi,Sphere:Ui,Spherical:Ws,Vector2:ut,Vector3:I,Vector4:Gt};Pe.install({THREE:x}),je({CameraControlsImpl:Pe})},[]);const{camera:s,domElement:i,makeDefault:r,onStart:o,onEnd:n,onChange:a,regress:l,...m}=e,g=Y(x=>x.camera),u=Y(x=>x.gl),f=Y(x=>x.invalidate),_=Y(x=>x.events),T=Y(x=>x.setEvents),v=Y(x=>x.set),O=Y(x=>x.get),h=Y(x=>x.performance),y=s||g,w=i||_.connected||u.domElement,p=c.useMemo(()=>new Pe(y),[y]);return Mt((x,E)=>{p.enabled&&p.update(E)},-1),c.useEffect(()=>(p.connect(w),()=>void p.disconnect()),[w,p]),c.useEffect(()=>{const x=U=>{f(),l&&h.regress(),a&&a(U)},E=U=>{o&&o(U)},C=U=>{n&&n(U)};return p.addEventListener("update",x),p.addEventListener("controlstart",E),p.addEventListener("controlend",C),p.addEventListener("control",x),p.addEventListener("transitionstart",x),p.addEventListener("wake",x),()=>{p.removeEventListener("update",x),p.removeEventListener("controlstart",E),p.removeEventListener("controlend",C),p.removeEventListener("control",x),p.removeEventListener("transitionstart",x),p.removeEventListener("wake",x)}},[p,o,n,f,T,l,a]),c.useEffect(()=>{if(r){const x=O().controls;return v({controls:p}),()=>v({controls:x})}},[r,p]),c.createElement("primitive",j({ref:t,object:p},m))});function kn(e,t){const s=c.useRef(),[i]=c.useState(()=>t?t instanceof Ae?{current:t}:t:s),[r]=c.useState(()=>new Si(void 0));c.useLayoutEffect(()=>{t&&(i.current=t instanceof Ae?t:t.current),r._root=i.current});const o=c.useRef({}),n=c.useMemo(()=>{const a={};return e.forEach(l=>Object.defineProperty(a,l.name,{enumerable:!0,get(){if(i.current)return o.current[l.name]||(o.current[l.name]=r.clipAction(l,i.current))},configurable:!0})),{ref:i,clips:e,actions:a,names:e.map(l=>l.name),mixer:r}},[e]);return Mt((a,l)=>r.update(l)),c.useEffect(()=>{const a=i.current;return()=>{o.current={},r.stopAllAction(),Object.values(n.actions).forEach(l=>{a&&r.uncacheAction(l,a)})}},[e]),n}function en(e){const t=c.useRef(null),s=c.useRef(!1),i=c.useRef(!1),r=c.useRef(e);return c.useLayoutEffect(()=>void(r.current=e),[e]),c.useEffect(()=>{const o=t.current;if(o){const n=zi(()=>(s.current=!1,!0)),a=o.onBeforeRender;o.onBeforeRender=()=>s.current=!0;const l=Ii(()=>(s.current!==i.current&&(r.current==null||r.current(i.current=s.current)),!0));return()=>{o.onBeforeRender=a,n(),l()}}},[]),t}function sn(e,t){const s=e+"Geometry";return c.forwardRef(({args:i,children:r,...o},n)=>{const a=c.useRef(null);return c.useImperativeHandle(n,()=>a.current),c.useLayoutEffect(()=>void(t==null?void 0:t(a.current))),c.createElement("mesh",j({ref:a},o),c.createElement(s,{attach:"geometry",args:i}),r)})}const Hn=sn("box"),Vn=c.forwardRef(({scale:e=10,frames:t=1/0,opacity:s=1,width:i=1,height:r=1,blur:o=1,near:n=0,far:a=10,resolution:l=512,smooth:m=!0,color:g="#000000",depthWrite:u=!1,renderOrder:f,..._},T)=>{const v=c.useRef(null),O=Y(q=>q.scene),h=Y(q=>q.gl),y=c.useRef(null);i=i*(Array.isArray(e)?e[0]:e||1),r=r*(Array.isArray(e)?e[1]:e||1);const[w,p,x,E,C,U,P]=c.useMemo(()=>{const q=new ht(l,l),k=new ht(l,l);k.texture.generateMipmaps=q.texture.generateMipmaps=!1;const vt=new Pi(i,r).rotateX(Math.PI/2),N=new fe(vt),dt=new Ri;dt.depthTest=dt.depthWrite=!1,dt.onBeforeCompile=X=>{X.uniforms={...X.uniforms,ucolor:{value:new Be(g)}},X.fragmentShader=X.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),X.fragmentShader=X.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const mt=new yt(Ni),K=new yt(ji);return K.depthTest=mt.depthTest=!1,[q,vt,dt,N,mt,K,k]},[l,i,r,e,g]),L=q=>{E.visible=!0,E.material=C,C.uniforms.tDiffuse.value=w.texture,C.uniforms.h.value=q*1/256,h.setRenderTarget(P),h.render(E,y.current),E.material=U,U.uniforms.tDiffuse.value=P.texture,U.uniforms.v.value=q*1/256,h.setRenderTarget(w),h.render(E,y.current),E.visible=!1};let A=0,W,G;return Mt(()=>{y.current&&(t===1/0||A<t)&&(A++,W=O.background,G=O.overrideMaterial,v.current.visible=!1,O.background=null,O.overrideMaterial=x,h.setRenderTarget(w),h.render(O,y.current),L(o),m&&L(o*.4),h.setRenderTarget(null),v.current.visible=!0,O.overrideMaterial=G,O.background=W)}),c.useImperativeHandle(T,()=>v.current,[]),c.createElement("group",j({"rotation-x":Math.PI/2},_,{ref:v}),c.createElement("mesh",{renderOrder:f,geometry:p,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},c.createElement("meshBasicMaterial",{transparent:!0,map:w.texture,opacity:s,depthWrite:u})),c.createElement("orthographicCamera",{ref:y,args:[-i/2,i/2,r/2,-r/2,n,a]}))});let ce;const rn=new Uint8Array(16);function nn(){if(!ce&&(ce=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ce))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ce(rn)}const Z=[];for(let e=0;e<256;++e)Z.push((e+256).toString(16).slice(1));function on(e,t=0){return Z[e[t+0]]+Z[e[t+1]]+Z[e[t+2]]+Z[e[t+3]]+"-"+Z[e[t+4]]+Z[e[t+5]]+"-"+Z[e[t+6]]+Z[e[t+7]]+"-"+Z[e[t+8]]+Z[e[t+9]]+"-"+Z[e[t+10]]+Z[e[t+11]]+Z[e[t+12]]+Z[e[t+13]]+Z[e[t+14]]+Z[e[t+15]]}const an=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ks={randomUUID:an};function Bn(e,t,s){if(Ks.randomUUID&&!t&&!e)return Ks.randomUUID();e=e||{};const i=e.random||(e.rng||nn)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){s=s||0;for(let r=0;r<16;++r)t[s+r]=i[r];return t}return on(i)}const ln=c.forwardRef(({children:e,compute:t,width:s,height:i,samples:r=8,renderPriority:o=0,eventPriority:n=0,frames:a=1/0,stencilBuffer:l=!1,depthBuffer:m=!0,generateMipmaps:g=!1,...u},f)=>{const{size:_,viewport:T}=Y(),v=me((s||_.width)*T.dpr,(i||_.height)*T.dpr,{samples:r,stencilBuffer:l,depthBuffer:m,generateMipmaps:g}),[O]=c.useState(()=>new Di),h=c.useCallback((y,w,p)=>{var x,E;let C=(x=v.texture)==null?void 0:x.__r3f.parent;for(;C&&!(C instanceof Ae);)C=C.__r3f.parent;if(!C)return!1;p.raycaster.camera||p.events.compute(y,p,(E=p.previousRoot)==null?void 0:E.getState());const[U]=p.raycaster.intersectObject(C);if(!U)return!1;const P=U.uv;if(!P)return!1;w.raycaster.setFromCamera(w.pointer.set(P.x*2-1,P.y*2-1),w.camera)},[]);return c.useImperativeHandle(f,()=>v.texture,[v]),c.createElement(c.Fragment,null,ki(c.createElement(cn,{renderPriority:o,frames:a,fbo:v},e,c.createElement("group",{onPointerOver:()=>null})),O,{events:{compute:t||h,priority:n}}),c.createElement("primitive",j({object:v.texture},u)))});function cn({frames:e,renderPriority:t,children:s,fbo:i}){let r=0,o,n;return Mt(a=>{(e===1/0||r<e)&&(o=a.gl.autoClear,n=a.gl.xr.enabled,a.gl.autoClear=!0,a.gl.xr.enabled=!1,a.gl.setRenderTarget(i),a.gl.render(a.scene,a.camera),a.gl.setRenderTarget(null),a.gl.autoClear=o,a.gl.xr.enabled=n,r++)},t),c.createElement(c.Fragment,null,s)}const hn=Wr({blur:0,map:null,sdf:null,blend:0,size:0,resolution:new ut},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
     vUv = uv;
   }`,`uniform sampler2D sdf;
   uniform sampler2D map;
   uniform float blur;
   uniform float size;
   uniform float time;
   uniform vec2 resolution;
   varying vec2 vUv;
   #include <packing>
   void main() {
     vec2 uv = gl_FragCoord.xy / resolution.xy;
     vec4 t = texture2D(map, uv);
     float k = blur;
     float d = texture2D(sdf, vUv).r/size;
     float alpha = 1.0 - smoothstep(0.0, 1.0, clamp(d/k + 1.0, 0.0, 1.0));
     gl_FragColor = vec4(t.rgb, blur == 0.0 ? t.a : t.a * alpha);
     #include <tonemapping_fragment>
     #include <${ii>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),Yn=c.forwardRef(({children:e,events:t=void 0,blur:s=0,eventPriority:i=0,renderPriority:r=0,worldUnits:o=!1,resolution:n=512,...a},l)=>{je({PortalMaterialImpl:hn});const m=c.useRef(null),{scene:g,gl:u,size:f,viewport:_,setEvents:T}=Y(),v=me(n,n),[O,h]=c.useState(0);Mt(()=>{const E=m.current.blend>0?Math.max(1,r):0;O!==E&&h(E)}),c.useEffect(()=>{t!==void 0&&T({enabled:!t})},[t]);const[y,w]=c.useState(!0),p=en(w);c.useLayoutEffect(()=>{var E;p.current=(E=m.current)==null?void 0:E.__r3f.parent},[]),c.useLayoutEffect(()=>{if(p.current&&s&&m.current.sdf===null){const E=new fe(p.current.geometry,new Ai),C=new Ne().setFromBufferAttribute(E.geometry.attributes.position),U=new Ve(C.min.x*(1+2/n),C.max.x*(1+2/n),C.max.y*(1+2/n),C.min.y*(1+2/n),.1,1e3);U.position.set(0,0,1),U.lookAt(0,0,0),u.setRenderTarget(v),u.render(E,U);const L=dn(n,n,u)(v.texture),A=new Float32Array(n*n);u.readRenderTargetPixels(L,0,0,n,n,A);let W=1/0;for(let G=0;G<A.length;G++)A[G]<W&&(W=A[G]);W=-W,m.current.size=W,m.current.sdf=L.texture,u.setRenderTarget(null)}},[n,s]),c.useImperativeHandle(l,()=>m.current);const x=c.useCallback((E,C,U)=>{var P;if(!p.current)return!1;if(C.pointer.set(E.offsetX/C.size.width*2-1,-(E.offsetY/C.size.height)*2+1),C.raycaster.setFromCamera(C.pointer,C.camera),((P=m.current)==null?void 0:P.blend)===0){const[L]=C.raycaster.intersectObject(p.current);if(!L)return C.raycaster.camera=void 0,!1}},[]);return c.createElement("portalMaterialImpl",j({ref:m,blur:s,blend:0,resolution:[f.width*_.dpr,f.height*_.dpr],attach:"material"},a),c.createElement(ln,{attach:"map",frames:y?1/0:0,eventPriority:i,renderPriority:r,compute:x},e,c.createElement(un,{events:t,rootScene:g,priority:O,material:m,worldUnits:o})))});function un({events:e=void 0,rootScene:t,material:s,priority:i,worldUnits:r}){const o=Y(u=>u.scene),n=Y(u=>u.setEvents),a=me(),l=me();c.useLayoutEffect(()=>{o.matrixAutoUpdate=!1},[]),c.useEffect(()=>{e!==void 0&&n({enabled:e})},[e]);const[m,g]=c.useMemo(()=>{const u={value:0};return[new bt(new yt({uniforms:{a:{value:a.texture},b:{value:l.texture},blend:u},vertexShader:`
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
          }`,fragmentShader:`
          uniform sampler2D a;
          uniform sampler2D b;
          uniform float blend;
          varying vec2 vUv;
          #include <packing>
          void main() {
            vec4 ta = texture2D(a, vUv);
            vec4 tb = texture2D(b, vUv);
            gl_FragColor = mix(tb, ta, blend);
            #include <tonemapping_fragment>
            #include <${ii>=154?"colorspace_fragment":"encodings_fragment"}>
          }`})),u]},[]);return Mt(u=>{var f;let _=s==null||(f=s.current)==null?void 0:f.__r3f.parent;if(_){if(r)o.matrixWorld.identity();else{var T;i&&((T=s.current)==null?void 0:T.blend)===1&&_.updateWorldMatrix(!0,!1),o.matrixWorld.copy(_.matrixWorld)}if(i){var v,O,h;((v=s.current)==null?void 0:v.blend)>0&&((O=s.current)==null?void 0:O.blend)<1?(g.value=s.current.blend,u.gl.setRenderTarget(a),u.gl.render(o,u.camera),u.gl.setRenderTarget(l),u.gl.render(t,u.camera),u.gl.setRenderTarget(null),m.render(u.gl)):((h=s.current)==null?void 0:h.blend)===1&&u.gl.render(o,u.camera)}}},i),c.createElement(c.Fragment,null)}const dn=(e,t,s)=>{let i=new ht(e,t,{minFilter:bi,magFilter:De,type:he,format:ve,generateMipmaps:!0}),r=new ht(e,t,{minFilter:$,magFilter:$}),o=new ht(e,t,{minFilter:$,magFilter:$}),n=new ht(e,t,{minFilter:$,magFilter:$}),a=new ht(e,t,{minFilter:$,magFilter:$}),l=new ht(e,t,{minFilter:$,magFilter:$,type:he,format:ve}),m=new ht(e,t,{minFilter:$,magFilter:$,type:he,format:ve});const g=new bt(new yt({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (round(texture2D(tex, vUv).x)));
        }`})),u=new bt(new yt({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (1.0 - round(texture2D(tex, vUv).x)));
        }`})),f=new bt(new yt({uniforms:{tex:{value:null},offset:{value:0},level:{value:0},maxSteps:{value:0}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform float offset;
        uniform float level;
        uniform float maxSteps;
        #include <packing>
        void main() {
          float closestDist = 9999999.9;
          vec2 closestPos = vec2(0.0);
          for (float x = -1.0; x <= 1.0; x += 1.0) {
            for (float y = -1.0; y <= 1.0; y += 1.0) {
              vec2 voffset = vUv;
              voffset += vec2(x, y) * vec2(${1/e}, ${1/t}) * offset;
              vec2 pos = unpackRGBATo2Half(texture2D(tex, voffset));
              float dist = distance(pos.xy, vUv);
              if(pos.x != 0.0 && pos.y != 0.0 && dist < closestDist) {
                closestDist = dist;
                closestPos = pos;
              }
            }
          }
          gl_FragColor = pack2HalfToRGBA(closestPos);
        }`})),_=new bt(new yt({uniforms:{tex:{value:null},size:{value:new ut(e,t)}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform vec2 size;
        #include <packing>
        void main() {
          gl_FragColor = vec4(distance(size * unpackRGBATo2Half(texture2D(tex, vUv)), size * vUv), 0.0, 0.0, 0.0);
        }`})),T=new bt(new yt({uniforms:{inside:{value:m.texture},outside:{value:l.texture},tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D inside;
        uniform sampler2D outside;
        uniform sampler2D tex;
        #include <packing>
        void main() {
          float i = texture2D(inside, vUv).x;
          float o =texture2D(outside, vUv).x;
          if (texture2D(tex, vUv).x == 0.0) {
            gl_FragColor = vec4(o, 0.0, 0.0, 0.0);
          } else {
            gl_FragColor = vec4(-i, 0.0, 0.0, 0.0);
          }
        }`}));return v=>{let O=i;v.minFilter=$,v.magFilter=$,g.material.uniforms.tex.value=v,s.setRenderTarget(r),g.render(s);const h=Math.ceil(Math.log(Math.max(e,t))/Math.log(2));let y=r,w=null;for(let p=0;p<h;p++){const x=Math.pow(2,h-p-1);w=y===r?n:r,f.material.uniforms.level.value=p,f.material.uniforms.maxSteps.value=h,f.material.uniforms.offset.value=x,f.material.uniforms.tex.value=y.texture,s.setRenderTarget(w),f.render(s),y=w}s.setRenderTarget(l),_.material.uniforms.tex.value=w.texture,_.render(s),u.material.uniforms.tex.value=v,s.setRenderTarget(o),u.render(s),y=o;for(let p=0;p<h;p++){const x=Math.pow(2,h-p-1);w=y===o?a:o,f.material.uniforms.level.value=p,f.material.uniforms.maxSteps.value=h,f.material.uniforms.offset.value=x,f.material.uniforms.tex.value=y.texture,s.setRenderTarget(w),f.render(s),y=w}return s.setRenderTarget(m),_.material.uniforms.tex.value=w.texture,_.render(s),s.setRenderTarget(O),T.material.uniforms.tex.value=v,T.render(s),s.setRenderTarget(null),O}};var ai={exports:{}},li={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ft=c;function mn(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var fn=typeof Object.is=="function"?Object.is:mn,pn=Ft.useState,_n=Ft.useEffect,yn=Ft.useLayoutEffect,vn=Ft.useDebugValue;function gn(e,t){var s=t(),i=pn({inst:{value:s,getSnapshot:t}}),r=i[0].inst,o=i[1];return yn(function(){r.value=s,r.getSnapshot=t,Re(r)&&o({inst:r})},[e,s,t]),_n(function(){return Re(r)&&o({inst:r}),e(function(){Re(r)&&o({inst:r})})},[e]),vn(s),s}function Re(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!fn(e,s)}catch{return!0}}function En(e,t){return t()}var On=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?En:gn;li.useSyncExternalStore=Ft.useSyncExternalStore!==void 0?Ft.useSyncExternalStore:On;ai.exports=li;var Zn=ai.exports;export{Hn as B,In as C,zn as G,Mn as H,Dn as K,Sn as L,Yn as M,bn as T,Xi as _,pe as a,An as b,kn as c,Vn as d,Pn as e,Je as f,Rn as g,Ln as h,Zn as s,Un as u,Bn as v};
